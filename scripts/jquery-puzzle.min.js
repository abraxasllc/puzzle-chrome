var __bind=function(b,a){return function(){return b.apply(a,arguments)}};(function(b){var a;b.fn.puzzle=function(y){var m,k,f,c,w,e,o,i,x,h,n,s,p,r,g,u,l,t,q,v,j,d;i=32;c=32;e=3;k=9;f=3;m=9;o=1;w=1;r={rows:4,cols:4,hole:16,shuffle:false,numbers:false,control:{shufflePieces:true,confirmShuffle:true,toggleNumbers:true,toggleOriginal:true,counter:true,timer:true,pauseTimer:false},success:{fadeOriginal:true,callback:undefined,callbackTimeout:300},animation:{shuffleRounds:3,shuffleSpeed:800,slidingSpeed:200,fadeOriginalSpeed:600},style:{gridSize:2,gridOverlap:true,backgroundOpacity:0.1}};d={shufflePieces:chrome.i18n.getMessage("msg_shuffle"),confirmShuffle:chrome.i18n.getMessage("msg_confirm_shuffle"),toggleNumbers:chrome.i18n.getMessage("msg_numbers"),toggleOriginal:chrome.i18n.getMessage("msg_original"),moves:chrome.i18n.getMessage("msg_moves"),seconds:chrome.i18n.getMessage("msg_seconds")};if(y&&!y.hole&&(y.rows||y.cols)){y.hole=(y.rows||r.rows)*(y.cols||r.cols)}y=b.extend(true,{},r,y);q=y.rows;s=y.cols;t=y.hole;p=y.control;j=y.success;x=y.animation;v=y.style;if(q<e||q>k){q=r.rows}if(s<f||s>m){s=r.rows}if(t<1||t>q*s){t=q*s}t--;if(x.slidingSpeed<o){x.slidingSpeed=o}if(x.shuffleSpeed<o){x.shuffleSpeed=o}if(x.fadeOriginalSpeed<o){x.fadeOriginalSpeed=o}if(x.shuffleRounds<w){x.shuffleRounds=w}n=function(D){var C,B,z,A;C=D.length;for(z=0;(0<=C?z<C:z>C);(0<=C?z+=1:z-=1)){A=z<t?z:z+1;B=parseInt(D.eq(z).attr("current"));if(A!==B){return false}}return true};h=function(B){var D,F,E,A,z,C;C=1;D=q*s-1;for(A=1;(1<=D?A<=D:A>=D);(1<=D?A+=1:A-=1)){F=A+1;E=q*s;for(z=F;(F<=E?z<=E:z>=E);(F<=E?z+=1:z-=1)){C*=(B[A-1]-B[z-1])/(A-z)}}return Math.round(C)===1};u=function(A,z){return parseInt(A)*s+parseInt(z)};l=function(z){return{row:Math.floor(z/s),col:z%s}};g=function(z){var A;A=z.css("border-left-width");if(z.css("border-left-style")!=="none"){switch(A){case"thin":return 2;case"medium":return 4;case"thick":return 6;default:return parseInt(A)||0}}return 0};return this.filter("img").each(function(){var F,I,J,M,G,D,E,C,L,A,K,z,H,B;G=b(this);L=false;H=false;z=y.shuffle;A=0;K=0;B=undefined;E=t;M=b("<div/>").addClass("wrapper").append(J);F=b("<div/>").addClass("background").appendTo(M);J=b("<div/>").addClass("piece").appendTo(M);I=b("<div/>").attr("class",G.attr("class")||"").addClass("puzzle").append(M);G.replaceWith(I);I.attr("id",G.attr("id")||"");D={gui:{border:g(I),padding:{left:parseInt(I.css("padding-left"))||0,right:parseInt(I.css("padding-right"))||0,top:parseInt(I.css("padding-top"))||0,bottom:parseInt(I.css("padding-bottom"))||0}},wrapper:{border:g(M),padding:parseInt(M.css("padding-left"))||0},background:{border:g(F)},piece:{border:g(J)}};I.removeAttr("id");I.replaceWith(G);G.one("load",function(){var ae,R,Z,aq,au,X,ao,ag,ad,ap,az,af,am,ay,T,S,Q,U,aa,Y,ax,ar,aw,V,ab,W,P,av,aj,an,ah,at,al,aA,ak,ai,ac,O,N;aA=v.gridSize===0&&v.gridOverlap;ar=s*(2*D.piece.border)+(s-1)*v.gridSize;ax=q*(2*D.piece.border)+(q-1)*v.gridSize;if(aA){ar-=(s-1)*D.piece.border;ax-=(q-1)*D.piece.border}G.css({height:"auto",width:"auto",visibility:"visible"});N=Math.floor((G.width()-ar)/s);P=Math.floor((G.height()-ax)/q);ab=s*N+ar;V=q*P+ax;an=G.attr("src");O=N+(2*D.piece.border)+v.gridSize;ac=P+(2*D.piece.border)+v.gridSize;W=function(aD,aB){var aC;aC={left:D.wrapper.padding+(aB*O),top:D.wrapper.padding+(aD*ac)};if(aA){aC.left-=aB*D.piece.border;aC.top-=aD*D.piece.border}return aC};ak=function(aP,aB){var aQ,aG,aD,aJ,aL,aK,aR,aI,aF,aO,aE,aC,aN,aH,aM;if(aB){if(T.is(".disabled")){return false}if(L){return false}if(A>0&&p.confirmShuffle&&!window.confirm(d.confirmShuffle)){return false}L=true;if(H){ag.removeClass("solved");ae.fadeTo(x.fadeOriginalSpeed,v.backgroundOpacity,function(){ae.remove().prependTo(U);return Z.removeClass("disabled")})}}if(B){B.stop()}H=false;z=true;A=0;K=0;if(ao){ao.removeClass("disabled")}if(au){au.val(A)}if(S){S.val(K)}aH=[];aI=0;while(aI<aP){aR=[];aJ=q*s;for(aF=0;(0<=aJ?aF<aJ:aF>aJ);(0<=aJ?aF+=1:aF-=1)){aR[aF]=aF}aR.splice(t,1);aH[aI]=[];aJ=q*s;for(aF=0;(0<=aJ?aF<aJ:aF>aJ);(0<=aJ?aF+=1:aF-=1)){if(aF===t){aH[aI][aF]=t;continue}aN=Math.floor(Math.random()*aR.length);aH[aI][aF]=aR[aN];aR.splice(aN,1)}if((aI+1)<aP||h(aH[aI])){aI++}}aK=0;aL=[];for(aG=0;(0<=aP?aG<aP:aG>aP);(0<=aP?aG+=1:aG-=1)){var aI=aG;aO=(aI+1)===aP;aJ=aH[aI].length;for(aD=0;(0<=aJ?aD<aJ:aD>aJ);(0<=aJ?aD+=1:aD-=1)){var aF=aD;if(aF===t){if(aO){E=t}continue}aC=aH[aI][aF];if(aC>t){aC-=1}aQ=az.eq(aC);aM=l(aF);aE=W(aM.row,aM.col);if(aO){aQ.attr("current",aF)}if(!(aB!=null)){aQ.css({left:aE.left,top:aE.top})}else{aQ.animate({left:aE.left,top:aE.top},aB,null,function(){aK++;if(aK===x.shuffleRounds*(q*s-1)){L=false;return(aK=0)}})}}}return aL};U=b("<div/>").addClass("wrapper").css({width:ab,height:V,borderWidth:D.wrapper.border,padding:D.wrapper.padding,position:"relative",overflow:"hidden"});ay=b("<div/>").addClass("piece").css({width:N,height:P,backgroundImage:("url("+(an)+")"),borderWidth:D.piece.border,position:"absolute",overflow:"hidden"}).append(b("<span/>").addClass("number"));az=b([]);for(av=0;(0<=q?av<q:av>q);(0<=q?av+=1:av-=1)){for(at=0;(0<=s?at<s:at>s);(0<=s?at+=1:at-=1)){ah=u(av,at);if(ah===t){continue}al=W(av,at);aa=-1*(at*O+D.piece.border);Y=-1*(av*ac+D.piece.border);if(aA){aa+=at*D.piece.border;Y+=av*D.piece.border}az=az.add(ay.clone().css({left:al.left,top:al.top,backgroundPosition:(""+(aa)+"px "+(Y)+"px")}).attr("current",ah).appendTo(U).children().text(ah+1).end())}}if(y.shuffle){ak(1)}ae=b("<div/>").addClass("background").css({width:ab,height:V,left:D.wrapper.padding-D.background.border,top:D.wrapper.padding-D.background.border,backgroundImage:("url("+(an)+")"),position:"absolute",opacity:v.backgroundOpacity}).prependTo(U);aq=b("<div/>").addClass("controls").css({padding:D.wrapper.padding});R=undefined;T=undefined;ad=undefined;ap=undefined;if(p.shufflePieces||p.toggleNumbers||p.toggleOriginal){R=b("<div/>").addClass("buttons").appendTo(aq);af=b("<a/>");if(p.shufflePieces){T=af.clone().addClass("shuffle").text(d.shufflePieces).appendTo(R)}if(p.toggleNumbers){ad=af.clone().addClass("numbers").text(d.toggleNumbers).appendTo(R);if(y.numbers){ad.addClass("toggle")}}if(p.toggleOriginal){ap=af.clone().addClass("original").text(d.toggleOriginal).appendTo(R)}Z=R.children()}ao=undefined;X=undefined;Q=undefined;if(p.counter||p.timer){ao=b("<div/>").addClass("display").appendTo(aq);am=b("<input/>").attr("readonly","readonly").val(0);if(p.counter){au=am.clone().appendTo(ao).after(d.moves)}if(p.timer){S=am.clone().appendTo(ao).after(d.seconds)}if(!y.shuffle){ao.addClass("disabled")}}ag=b("<div/>").attr("class",G.attr("class")||"").addClass("puzzle").css({width:ab+2*(D.wrapper.padding+D.wrapper.border),overflow:"hidden"}).append(U).append(aq);G.replaceWith(ag);aj=G.attr("id");if(aj){ag.attr("id",aj)}if(!y.numbers){az.children().hide()}ag.mousedown(function(){return false});Z.mousedown(function(){return !b(this).is(".disabled")?b(this).addClass("down"):undefined});Z.mouseout(function(){return b(this).removeClass("down")});Z.mouseup(function(){return b(this).removeClass("down")});az.click(function(){var aB,aE,aC,aD;if(L){return false}if(H){return false}L=true;aB=b(this);aE=aB.attr("current");aD=l(aE);aC=l(E);if(Math.abs(aD.row-aC.row)+Math.abs(aD.col-aC.col)!==1){L=false;return false}al=W(aC.row,aC.col);aB.attr("current",E);E=aE;if(z){A++}if(au){au.val(A)}if(A===1){if(!B){B=new a(333,function(aF){K=Math.floor(aF/1000);return S?S.val(K):undefined})}B.start()}return aB.animate({left:al.left,top:al.top},x.slidingSpeed,null,function(){if(z){H=n(az);if(H){if(B){B.stop()}z=false;ag.addClass("solved");return window.setTimeout(aw,100)}else{return(L=false)}}else{return(L=false)}})});if(p.shufflePieces){T.click(function(){return ak(x.shuffleRounds,x.shuffleSpeed)})}if(p.toggleNumbers){ad.click(function(){if(ad.is(".disabled")){return false}if(ad.is(".toggle")){ad.removeClass("toggle");return az.children().hide()}else{ad.addClass("toggle");return az.children().show()}})}if(p.toggleOriginal){ap.click(function(){if(ap.is(".disabled")){return false}if(L){return false}L=true;if(ap.is(".toggle")){if(p.shufflePieces){T.removeClass("disabled")}if(p.toggleNumbers){ad.removeClass("disabled")}ap.removeClass("toggle");ae.fadeTo(x.fadeOriginalSpeed,v.backgroundOpacity,function(){b(this).prependTo(U);if(p.pauseTimer&&B){B.resume()}return(L=false)})}else{if(p.shufflePieces){T.addClass("disabled")}if(p.toggleNumbers){ad.addClass("disabled")}ap.addClass("toggle");if(p.pauseTimer&&B){B.pause()}ae.appendTo(U).fadeTo(x.fadeOriginalSpeed,1,function(){return(L=false)})}return false})}aw=function(){if(j.fadeOriginal){if(p.toggleOriginal){ap.addClass("disabled")}if(p.toggleNumbers){ad.addClass("disabled")}return ae.appendTo(U).fadeTo(x.fadeOriginalSpeed,1,function(){L=false;return ai()})}else{L=false;return ai()}};return(ai=function(){return b.isFunction(j.callback)?setTimeout(function(){return j.callback({moves:A,seconds:K})},j.callbackTimeout):undefined})});return(C=setInterval(function(){if(G[0].complete){clearInterval(C);return G.trigger("load")}},333))}).end()};b(document).ready(function(){return b("img.puzzle").each(function(){return b(this).puzzle()})});a=function(c,d){this.interval=c;this.callback=d;this.timeout=undefined;this.startTime=undefined;this.startPauseTime=undefined;this.totalPause=0;return this};a.prototype.run=function(){this.update(new Date().getTime());return(this.timeout=setTimeout((__bind(function(){return this.run()},this)),this.interval))};a.prototype.update=function(c){return this.callback(c-this.totalPause-this.startTime)};a.prototype.start=function(){if(this.startTime!=null){return false}this.startTime=new Date().getTime();return this.run()};a.prototype.stop=function(){var c;if(!(this.startTime!=null)){return false}clearTimeout(this.timeout);c=new Date().getTime();if(this.startPauseTime!=null){this.totalPause+=c-this.startPauseTime}this.update(c);this.startTime=undefined;this.startPauseTime=undefined;return(this.totalPause=0)};a.prototype.pause=function(){if(!(this.startTime!=null)||(this.startPauseTime!=null)){return false}clearTimeout(this.timeout);return(this.startPauseTime=new Date().getTime())};a.prototype.resume=function(){if(!(this.startPauseTime!=null)){return false}this.totalPause+=new Date().getTime()-this.startPauseTime;this.startPauseTime=undefined;return this.run()};return a})(jQuery);